{{ define "main" }}
  <main class="docs w-full max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8 md:flex gap-16 relative">
    {{ partial "docs-nav.html" . }}

    <section class="prose prose-slate w-full max-w-[47rem] py-12">
      {{ .Render "content" }}

      {{ $bazzar := $.Param "bazzar" }}
      {{ $has_groups := true }}
      {{ $group_name := "language" }}
      {{ $groups := dict }}
      {{ if or (eq $bazzar "clients") (eq $bazzar "libraries") }}
        {{ range $k, $v := $.Site.Data.languages }}
          {{ if (index (index $.Site.Data.repos $bazzar) $v) }}
            {{ $groups = merge $groups (dict $v $k) }}
          {{ end }}
        {{ end }}
      {{ else if eq $bazzar "tools" }}
        {{ $group_name = "tool type" }}
        {{ range $k, $v := $.Site.Data.tool_types }}
          {{ if (index (index $.Site.Data.repos $bazzar) $k) }}
            {{ $groups = merge $groups (dict $k $v) }}
          {{ end }}
        {{ end }}
      {{ else }}
        {{ $groups = merge $groups (dict "community" "Community") }}
        {{ $has_groups = false }}
      {{ end }}

      <h1>{{ .Title }}</h1>

      <p class="max-w-xl">
        The recommended repositories are marked with a <i class="todo"></i></span>. Repositories with some activity within the latest six months are marked with a <i class="todo"></i>. Want your repository listed here? Just submit a PR to the <a href="https://github.com/redis/redis-doc/pull/new">redis-doc repository</a>.
      </p>

      <div class="bazzar-list">
        {{ range $id, $name := $groups }}
          {{ if $has_groups }}
            <div id="{{ $id }}" class="bazzar-section">
              <h3>{{ $name }}</h3>
            </div>
          {{ end }}
          {{ $repos := (index (index $.Site.Data.repos $bazzar) $id) }}
          {{ $sorted := slice }}
          {{ range $name, $data := $repos }}
            {{ $data = merge $data (dict "name" $name) }}
            {{ $sorted = $sorted | append $data }}
          {{- end }}
          {{ $sorted = sort (sort $sorted "stargazers_count" "desc") "active" "desc" }}
          {{ range $sorted }}
            <div>
              {{ .name }}
            </div>
            <div>{{ .description }}</div>
            <div>
              {{ $recommended := and (isSet . "recommended") (.recommended) }}
              {{ $active := and (isSet . "active") (.active) }}
              {{ if $recommended }}
                <i class="todo"></i>
              {{ else if $active }}
                <i class="todo"></i>
              {{- end }}
            </div>
            <div>
              <a href="https://{{ .repository }}">
                <i class="todo"></i>
                {{ .license | default "Other" }}
              </a>
            </div>
            <div>
              {{ $stars := isSet . "stargazers_count" }}
              {{ if $stars }}
                <i class="todo"></i>
                {{ .stargazers_count }}
              {{ end }}
            </div>
            <div>
              {{ $home := isSet . "homepage" }}
              {{ if $home }}
                <a href="{{ .home }}">
                  <i class="fa fa-home"></i>
                </a>
              {{ end }}
            </div>
          {{ end }}
        {{ end }}
      </div>
    </section>

    {{ if $has_groups }}
      <aside class="hidden xl:block w-52 h-full shrink-0">
        <nav class="w-52 z-40 bg-white hidden md:block overflow-auto fixed top-28 h-full max-h-[calc(100vh-15rem)] text-[0.8125rem]">
          <dt class="font-semibold mb-3">Browse by {{ $group_name }}</dt>
          <dd class="text-slate-600">
            <ul id="TableOfContents">
              {{ range $id, $name := $groups }}
                <li>
                  <a href="#{{ $id }}">{{ $name }}</a>
                </li>
              {{ end }}
            </ul>
          </dd>
        </dl>
      </aside>
    {{ end }}
  </main>
{{ end }}

{{/*
  <!--
    <h3>Browse by {{ $group_name }}</h3>
    <div class="text-sm grid grid-cols-[repeat(auto-fit,minmax(10rem,1fr))] gap-2">
      {{ range $id, $name := $groups }}
        <a class="flex items-center justify-center rounded-md p-2 no-underline transition text-slate-900 hover:text-indigo-900 focus-within:text-indigo-900 bg-white hover:bg-indigo-50/50 focus-within:bg-indigo-50/50 border border-slate-900/10 hover:border-indigo-200 focus-within:border-indigo-300 focus-within:ring-indigo-200 focus-within:ring-[3px] focus-within:outline-none bg-clip-padding shadow shadow-slate-900/5" href="#{{ $id }}">{{ $name }}</a>
      {{ end }}
    </div>
    {{ end }}
  -->
*/}}