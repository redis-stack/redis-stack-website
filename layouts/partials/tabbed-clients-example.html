{{ $step := .Scratch.Get "step" }}
{{ $id := .Scratch.Get "example" }}
{{ if not (isset $.Site.Data.examples $id) }}
    {{ warnf "[tabbed-clients-example] Example not found %q for %q" $id $.Page }}
{{ end }}

{{ $tabs := slice }}
{{ $languages := index $.Site.Data.examples $id }}
{{ range $language := $.Site.Params.clientsexamples }}
    {{ $example := index $languages $language }}
    {{ if $example }}
        {{ $examplePath := index $example "target" }}
        {{ $options := printf "linenos=false" }}

        {{ if and (ne $step "") (isset $example "steps") (isset $example.steps $step) }}
            {{ $options = printf "%s,hl_lines=%s" $options (index $example.steps $step) }}
        {{ else }}
            {{ if isset $example "highlight" }}
                {{ $options = printf "%s,hl_lines=%s" $options (delimit (index $example "highlight") " ") }}
            {{ end }}
        {{ end }}
        {{ $params := dict "language" $language "contentPath" $examplePath "options" $options }}
        {{ $content := partial "tabs/source.html" $params }}
        {{ $tabs = $tabs | append (dict "title" $language "content" $content) }}
    {{ end }}
{{ end }}

{{ $params := dict "id" (printf "%s-step%d" $id $step) "tabs" $tabs }}
{{ partial "tabs/wrapper.html" $params }}
